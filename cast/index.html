<!DOCTYPE html>
<html>
<base href="../">
<title>eLitet Cast Live</title>
<head>
<script src="jellybean/hls.min.js"></script>
<style>
body {
	background-color: black;
}
#video {
	position: absolute;
	top: 0px;
	right: 0px;
	bottom: 0px;
	left: 0px;
	margin: auto;
	max-height: 100%;
	max-width: 100%;
	width: 100%; 
	height: 100%;
	z-index: -1;
}
#alert {
    padding: 20px;
    background-color: #f44336; /* Red */
	font-family: "Century Gothic";
	font-size: 48pt;
	font-weight: 700;
	text-align: center;
    color: whitesmoke;
    margin-bottom: 15px;
	display: none;
}
</style>
</head>
<body>
<div id="alert"></div>
<video id="video" autoplay></video>
<script>
	
var channel = 1;
var queue = [];
var titleset = [];
var video = document.getElementById('video');

function wickJSON(path)
{
    var xhr = new XMLHttpRequest();
    xhr.onload = function() {
		return JSON.parse(xhr.responseText);
	};
    xhr.open("GET", path, true);
    xhr.send();
}

function announce(castid)
{
	var channeld = castid;
	var title = titleset[castid-1];
	var div = document.getElementById("alert");
	div.innerHTML = channeld+" "+title;
	div.style.display = "block";
	setTimeout(function(){ div.style.display = "none"; }, 800);
}
	
function init()
{
	var feed = wickJSON("jellybean/feed.json").feed;
	/*
	var feed = JSON.parse('{"feed":[{"MSNBC":"https://tvemsnbc-lh.akamaihd.net/i/nbcmsnbc_1@122532/index_4296_av-b.m3u8?sd=10&rebase=on"},{"FOX News":"https://fncgohls-i.akamaihd.net/hls/live/263399/FNCGOHLSv2/Fox_News_v2_VIDEO_0_2564000.m3u8"},{"CBS News":"https://cbsnewshd-lh.akamaihd.net/i/CBSNHD_7@199302/index_2200_av-b.m3u8?sd=10&rebase=on"},{"Bloomberg":"https://liveproduseast.global.ssl.fastly.net/us/Channel-USTV-AWS-virginia-1/Source-USTV-1000-1_live.m3u8"}]}').feed;
	*/

	for (entry in feed) {
		var eacha = feed[entry];
		var title = (Object.keys(eacha))[0];
		var rqsdURI = eacha[title];
		var hls = new Hls();
		var m3u8Url = decodeURIComponent(rqsdURI);
		hls.loadSource(m3u8Url);
		hls.startFragPrefetch = true;
		queue.push(hls);
		titleset.push(title);
	}
	
	queue[0].attachMedia(video);
	queue[0].on(Hls.Events.MANIFEST_PARSED, function() {
		video.play();
	});
	
	window.onkeyup = function(e) {
		var prev = channel;
		var key = e.keyCode ? e.keyCode : e.which;
		if (key == 39 || key == 40) {
			channel++;
			if (channel > queue.length) 
				channel = queue.length;
		} else if (key == 37 || key == 38) {
			channel--;
			if (channel < 1) 
				channel = 1;
		}
		announce(channel);
		queue[channel-1].attachMedia(video);
		queue[channel-1].on(Hls.Events.MANIFEST_PARSED, function() {
			video.play();
		});
	}
}

init();
	
</script>
</body>
</html>