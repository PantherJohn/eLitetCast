<!DOCTYPE html>
<html>
<base href="../">
<title>eLitet Cast Live</title>
<head>
<script src="jellybean/hls.min.js"></script>
<style>
body {
	background-color: black;
}
#alert {
    padding: 20px;
    background-color: #f44336;
	font-family: "Century Gothic";
	font-size: 48pt;
	font-weight: 700;
	text-align: center;
    color: whitesmoke;
    margin-bottom: 15px;
	display: none;
}
</style>
</head>
<body>
<div id="alert"></div>
<script>
	
var channel = 1;
var queue = [];
var titleset = [];
var optimizdq = [];
var debug = false;
var bypass = true;
var estateFeed = "jellybean/feed.json";

function wickJSON(estate) {
	var resp = '';
	var xmlHttp = new XMLHttpRequest();
	if(xmlHttp != null)
	{
		xmlHttp.open("GET", estate, false);
		xmlHttp.send(null);
		resp = xmlHttp.responseText;
	}
	return JSON.parse(resp);
}	

function denounce(castid)
{
	optimizdq[castid-1].muted = true;
	optimizdq[castid-1].style.display = "none";
}	

function announce(castid)
{
	var channeld = castid;
	var title = titleset[castid-1];
	optimizdq[channeld-1].muted = false;
	optimizdq[channeld-1].style.display = "block";
	var div = document.getElementById("alert");
	div.innerHTML = channeld+" "+title;
	div.style.display = "block";
	setTimeout(function(){ div.style.display = "none"; }, 800);
}
	
function init()
{
	if (!debug)
		var feed = wickJSON(estateFeed).feed;
	else
		var feed = JSON.parse('{"feed":[{"CBS News":"https://cbsnewshd-lh.akamaihd.net/i/CBSNHD_7@199302/index_2200_av-b.m3u8?sd=10&rebase=on"},{"Bloomberg":"https://liveproduseast.global.ssl.fastly.net/us/Channel-USTV-AWS-virginia-1/Source-USTV-1000-1_live.m3u8"},{"WNYW":"https://player-api.new.livestream.com/accounts/6372917/events/2592483/stream_info"}]}').feed;
	
	for (entry in feed) {
		var eacha = feed[entry];
		var title = (Object.keys(eacha))[0];
		var rqsdURI = eacha[title];
		var hls = new Hls();
		var m3u8Url = decodeURIComponent(rqsdURI);
		var anxView = document.createElement("video");
		anxView.muted = true;
		//anxView.autoplay = true;
		
		// - Livesteam API
		if (m3u8Url.indexOf("livestream.com")!=-1 && 
		   	m3u8Url.indexOf(".m3u8")==-1) {
			if (bypass)
				m3u8Url += "https://cors-anywhere.herokuapp.com/";
			m3u8Url = wickJSON(m3u8Url).secure_m3u8_url;
		}
		
		hls.loadSource(m3u8Url);
		hls.startFragPrefetch = true;
		hls.attachMedia(anxView);
		document.body.appendChild(anxView);
		anxView.style.cssText = "position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; margin: auto; max-height: 100%; max-width: 100%; width: 100%; height: 100%; z-index: -1; display: none;";
		anxView.play();
		queue.push(hls);
		optimizdq.push(anxView);
		titleset.push(title);
	}
	
	announce(1);
	
	window.onkeyup = function(e) {
		denounce(1);
		var prev = channel;
		var key = e.keyCode ? e.keyCode : e.which;
		if (key == 39 || key == 40) {
			channel++;
			if (channel > queue.length) 
				channel = queue.length;
		} else if (key == 37 || key == 38) {
			channel--;
			if (channel < 1) 
				channel = 1;
		}
		denounce(prev);
		announce(channel);
	}
}

	init();
	
</script>
</body>
</html>
